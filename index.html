<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pro Productivity Dashboard</title>
<link rel="icon" href="https://img.icons8.com/?size=80&id=WzwD40yUyIpm&format=png" type="image/png">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>

<style>
  :root {
    --bg-color: #0f172a;       /* Deep Navy Blue */
    --card-bg: #1e293b;       /* Slate Blue */
    --accent: #7b38f8;        /* Purple */
    --text-main: #f8fafc;
    --text-dim: #94a3b8;
  }

  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    height: 100vh;
    margin: 0;
    padding: 20px;
    background: var(--bg-color);
    color: var(--text-main);
    box-sizing: border-box;
    overflow: hidden;
  }

  .header {
    width: 100%;
    max-width: 1400px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }

  .controls {
    display: flex;
    gap: 8px;
    background: var(--card-bg);
    padding: 6px;
    border-radius: 12px;
    border: 1px solid #334155;
  }

  button {
    padding: 10px 18px;
    cursor: pointer;
    border: none;
    background: transparent;
    color: var(--text-dim);
    border-radius: 8px;
    font-weight: 600;
    font-size: 14px;
    transition: all 0.2s ease;
  }

  button:hover {
    color: var(--text-main);
    background: #334155;
  }

  button.active {
    background: var(--accent);
    color: #fff;
  }

  .chart-wrapper {
    width: 100%;
    max-width: 1600px;
    flex-grow: 1;
    background: #f4f4f4; /* Matching the original "Inspirational" background */
    border-radius: 20px;
    padding: 25px;
    border: 1px solid #334155;
    box-shadow: 0 20px 50px rgba(0,0,0,0.3);
    position: relative;
    box-sizing: border-box;
  }

  canvas {
    width: 100% !important;
    height: 100% !important;
  }

  h1 {
    font-size: 1.5rem;
    margin: 0;
    letter-spacing: -0.5px;
  }
</style>
</head>

<body>

<div class="header">
  <h1>Productivity <span style="color: var(--accent)">Challenge</span></h1>
  <div class="controls">
    <button onclick="updateView('daily', this)">Daily</button>
    <button onclick="updateView('weekly', this)">Weekly</button>
    <button onclick="updateView('monthly', this)">Monthly</button>
    <button onclick="updateView('yearly', this)">Yearly</button>
    <button onclick="updateView('lifetime', this)" class="active">Lifetime</button>
  </div>
</div>

<div class="chart-wrapper">
  <canvas id="heartbeatChart"></canvas>
</div>

<script>
const SHEET_URL = "https://docs.google.com/spreadsheets/d/1ocnFi7S8d2a_HEv-3qXASBY9lUFcCqV6I0Z5-BY3JMY/gviz/tq?tqx=out:csv";

let fullData = {};
let chart;
let progress = 0;
let animationFrameId;

async function loadSheetData(){
  const res = await fetch(SHEET_URL);
  const text = await res.text();
  const rows = text.trim().split("\n").slice(1);
  const labels=[], work=[], completed=[], pending=[];

  rows.forEach(row=>{
    const cols = row.split(",").map(v => v.replace(/"/g,"").trim());
    labels.push(cols[0]);
    work.push(Number(cols[1]));
    completed.push(Number(cols[2]));
    pending.push(Number(cols[3]));
  });
  return {labels, work, completed, pending};
}

// Same reveal plugin from original code
const revealPlugin = {
  id:'reveal',
  beforeDatasetDraw(chart,args){
    const {ctx, chartArea:{left,right,top,bottom}} = chart;
    const prog = chart._revealProgress || 0;
    if(args.meta.type === "line"){
      ctx.save();
      ctx.beginPath();
      ctx.rect(left, top, (right-left)*prog, bottom-top);
      ctx.clip();
    }
  },
  afterDatasetDraw(chart,args){
    if(args.meta.type === "line"){
      chart.ctx.restore();
    }
  }
};

function animate() {
  progress += 0.002; // Matching speed closer to original
  if (progress <= 1) {
    chart._revealProgress = progress;
    chart.update();
    animationFrameId = requestAnimationFrame(animate);
  }
}

function updateView(range, btn) {
  document.querySelectorAll('button').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');

  let sliceCount;
  switch(range) {
    case 'daily': sliceCount = 2; break;
    case 'weekly': sliceCount = 7; break;
    case 'monthly': sliceCount = 30; break;
    case 'yearly': sliceCount = 365; break;
    default: sliceCount = fullData.labels.length;
  }

  chart.data.labels = fullData.labels.slice(-sliceCount);
  chart.data.datasets[0].data = fullData.work.slice(-sliceCount);
  chart.data.datasets[1].data = fullData.completed.slice(-sliceCount);
  chart.data.datasets[2].data = fullData.pending.slice(-sliceCount);

  // Reset animation
  cancelAnimationFrame(animationFrameId);
  progress = 0;
  animate();
}

loadSheetData().then(data => {
  fullData = data;
  const ctx = document.getElementById("heartbeatChart").getContext("2d");

  chart = new Chart(ctx, {
    type: "line",
    data: {
      labels: data.labels,
      datasets: [
        {
          label: "Number of Work",
          data: data.work,
          borderColor: "#FF5733", // Original Red-Orange
          backgroundColor: "#FF5733",
          fill: false,
          tension: 0.3,
          pointRadius: 5
        },
        {
          label: "Completed",
          data: data.completed,
          borderColor: "#33FF57", // Original Green
          backgroundColor: "#33FF57",
          fill: false,
          tension: 0.3,
          pointRadius: 5
        },
        {
          label: "Pending",
          data: data.pending,
          borderColor: "#3357FF", // Original Blue
          backgroundColor: "#3357FF",
          fill: false,
          tension: 0.3,
          pointRadius: 5
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      animation: false,
      layout: {
        padding: {left: 20, right: 20, top: 10, bottom: 10}
      },
      plugins: {
        legend: { position: "top" },
        title: {
          display: true,
          text: "2025 Productivity Challenge",
          font: { size: 18 }
        }
      },
      scales: {
        x: { title: { display: true, text: "Date" } },
        y: {
          title: { display: true, text: "Task Count" },
          beginAtZero: true,
          ticks: { stepSize: 1 }
        }
      }
    },
    plugins: [revealPlugin]
  });

  animate();
});
</script>

</body>
</html>